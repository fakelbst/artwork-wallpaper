{% extends 'base.html' %}

{% block body %}
<link href="{{ static('javascripts/libs/progressjs.min.css') }}" rel="stylesheet">

<img id="img">
<input type="button" value="test" id="ok">
<script src="{{ static('javascripts/libs/progress.min.js') }}"></script>

<script>
  var tid = '';
  function checkFinish(){
    $.ajax({
      type: 'GET',
      url: '/task_result/'+tid
    }).done(function(data){
      if(data.ready){
        clearInterval(checkFinish);
        progressJs().setOptions({overlayMode: true, theme: 'blueOverlay'}).end();
        window.location.href = '/img/'+tid;
      }
      else{
          // progressJs().setOptions({overlayMode: true, theme: 'blueOverlay'}).increase(5);
          progressJs().setOptions({overlayMode: true, theme: 'blueOverlay'}).set(data.current*100)
      }
    });
  }

  $(function(){
    $('#ok').on('click', function(){
      var width = screen.width,
          height = screen.height;
      $.ajax({
        type: 'POST',
        url: '/genimg',
        data: {width: width, height: height}
      }).done(function(data){
        console.log(data);
        if(data.success){
          progressJs().setOptions({overlayMode: true, theme: 'blueOverlay'}).start();//.increase(5);
          tid = data.task_id;
          setInterval(checkFinish, 3000);
        }
      });
    });
  });
</script>

{% endblock %}
