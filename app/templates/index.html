{% extends 'base.html' %}

{% block body %}
<link href="{{ static('javascripts/libs/progressjs.min.css') }}" rel="stylesheet">

<img id="img">
<input type="button" value="test" id="ok">
<script src="{{ static('javascripts/libs/progress.min.js') }}"></script>

<script>
  var tid = '';
  function checkFinish(){
    $.ajax({
      type: 'GET',
      url: '/task_result/'+tid
    }).done(function(data){
      if(data.ready){
        clearInterval(checkFinish);
        progressJs().setOptions({overlayMode: true, theme: 'blueOverlay'}).end();
        window.location.href = '/img/'+tid;
      }
      else{
          progressJs().setOptions({overlayMode: true, theme: 'blueOverlay'}).increase(5);
      }
    });
  }

  $(function(){
    $('#ok').on('click', function(){
      $.ajax({
        type: 'POST',
        url: '/genimg'
      }).done(function(data){
        console.log(data);
        if(data.success){
          progressJs().setOptions({overlayMode: true, theme: 'blueOverlay'}).start();//.increase(5);
          // setInterval(checkFinish(data.task_id), 1000);
          
          tid = data.task_id;
          setInterval(checkFinish, 3000);
        }
      });
    });
  });
</script>

{% endblock %}
